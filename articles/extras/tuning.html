<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuning Cubist Models • Cubist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Tuning Cubist Models">
<meta property="og:description" content="Cubist">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">Cubist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.40.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/cubist.html">Introduction</a>
</li>
<li>
  <a href="../../articles/extras/tuning.html">Tuning</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/topepo/Cubist/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tuning_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tuning Cubist Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/topepo/Cubist/blob/master/vignettes/extras/tuning.Rmd"><code>vignettes/extras/tuning.Rmd</code></a></small>
      <div class="hidden name"><code>tuning.Rmd</code></div>

    </div>

    
    
<p>The main two parameters for this model are the number of committees as well as the number of neighbors (if any) to use to adjust the model predictions. We’ll use two different packages for model tuning. Each will split and resample the data with different code. Their results will be very similar but will not be equal.</p>
<p>Before starting, we’ll use the Ames housing data again.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span>
<span class="co"># model the data on the log10 scale</span>
<span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span>

<span class="va">predictors</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lot_Area"</span>, <span class="st">"Alley"</span>, <span class="st">"Lot_Shape"</span>, <span class="st">"Neighborhood"</span>, <span class="st">"Bldg_Type"</span>, 
    <span class="st">"Year_Built"</span>, <span class="st">"Total_Bsmt_SF"</span>, <span class="st">"Central_Air"</span>, <span class="st">"Gr_Liv_Area"</span>, 
    <span class="st">"Bsmt_Full_Bath"</span>, <span class="st">"Bsmt_Half_Bath"</span>, <span class="st">"Full_Bath"</span>, <span class="st">"Half_Bath"</span>, 
    <span class="st">"TotRms_AbvGrd"</span>,  <span class="st">"Year_Sold"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>
<span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span>

<span class="va">ames</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sale_Price"</span>, <span class="va">predictors</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div id="model-tuning-via-caret" class="section level2">
<h2 class="hasAnchor">
<a href="#model-tuning-via-caret" class="anchor"></a>Model Tuning via caret</h2>
<p>To tune the model over different values of <code>neighbors</code> and <code>committees</code>, the <code>train</code> function in the <a href="https://CRAN.R-project.org/package=caret"><code>caret</code></a> package can be used to optimize these parameters. For example, to split the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">in_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span>, times <span class="op">=</span> <span class="fl">1</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">caret_train</span> <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span> <span class="va">in_train</span>,<span class="op">]</span>
<span class="va">caret_test</span>  <span class="op">&lt;-</span> <span class="va">ames</span><span class="op">[</span><span class="op">-</span><span class="va">in_train</span>,<span class="op">]</span></code></pre></div>
<p>We’ll use basic 10-fold cross-validation to tune the models over the two parameters. Although <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> can make its own grid, we’ll use a regular grid with four values per parameter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>committees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, neighbors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">caret_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">caret_train</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Sale_Price</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="va">caret_train</span><span class="op">$</span><span class="va">Sale_Price</span>,
  method <span class="op">=</span> <span class="st">"cubist"</span>,
  tuneGrid <span class="op">=</span> <span class="va">grid</span>,
  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">caret_grid</span></code></pre></div>
<pre><code>## Cubist 
## 
## 1466 samples
##   17 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 1320, 1320, 1318, 1321, 1319, 1318, ... 
## Resampling results across tuning parameters:
## 
##   committees  neighbors  RMSE         Rsquared   MAE        
##     1         0          0.006980097  0.7823656  0.004445466
##     1         1          0.007736511  0.7607675  0.004892528
##     1         5          0.006725394  0.8022236  0.004216278
##     1         9          0.006618399  0.8077642  0.004161582
##    10         0          0.006554084  0.8089811  0.004105507
##    10         1          0.007649352  0.7658593  0.004737154
##    10         5          0.006505652  0.8154348  0.004058009
##    10         9          0.006394992  0.8208995  0.004005872
##    50         0          0.006419605  0.8170101  0.004032752
##    50         1          0.007574183  0.7703286  0.004686879
##    50         5          0.006387367  0.8218289  0.003998214
##    50         9          0.006276516  0.8272191  0.003941817
##   100         0          0.006381553  0.8191074  0.004008798
##   100         1          0.007566783  0.7703920  0.004680454
##   100         5          0.006357572  0.8232121  0.003983422
##   100         9          0.006243052  0.8288578  0.003926840
## 
## RMSE was used to select the optimal model using the smallest value.
## The final values used for the model were committees = 100 and neighbors = 9.</code></pre>
<p>Note that the x/y interface was used. This keeps factor predictors intact; if the formula method had been used, factor predictors like <code>Neighborhood</code> would have been converted to binary indicator columns. That would not cause an error, but Cubist usually works better without the indicators columns.</p>
<p>The next figure shows the profiles of the tuning parameters produced using <code>ggplot(caret_grid)</code>.</p>
<p><img src="tuning_files/figure-html/plot-tune-1.png" width="700"></p>
<p>The <code>caret_grid</code> object selected and fit the final model (with the best results). The test data are predicted using:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">caret_grid</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">caret_test</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.7239910 0.7271985 0.7235518 0.7224333 0.7280025 0.7244288</code></pre>
</div>
<div id="model-tuning-via-tidymodels" class="section level2">
<h2 class="hasAnchor">
<a href="#model-tuning-via-tidymodels" class="anchor"></a>Model Tuning via tidymodels</h2>
<p>The tidymodels packages have a slightly different approach to package development. Whereas <code>caret</code> contains a large number of functions, tidymodels splits the code into small packages that do a few common tasks (e.g. resampling, performance estimation). To start, load the <code>tidymodels</code> package and this will attach the main set of core packages:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────────── tidymodels 0.1.3 ──</code></pre>
<pre><code>## ✔ broom        0.7.6      ✔ rsample      0.1.0 
## ✔ dials        0.0.9      ✔ tibble       3.1.2 
## ✔ dplyr        1.0.6      ✔ tidyr        1.1.3 
## ✔ infer        0.5.4      ✔ tune         0.1.5 
## ✔ modeldata    0.1.0      ✔ workflows    0.2.2 
## ✔ parsnip      0.1.5      ✔ workflowsets 0.0.2 
## ✔ purrr        0.3.4      ✔ yardstick    0.0.8 
## ✔ recipes      0.1.16</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
## ✖ purrr::discard()         masks scales::discard()
## ✖ dplyr::filter()          masks stats::filter()
## ✖ dplyr::lag()             masks stats::lag()
## ✖ purrr::lift()            masks caret::lift()
## ✖ yardstick::precision()   masks caret::precision()
## ✖ yardstick::recall()      masks caret::recall()
## ✖ yardstick::sensitivity() masks caret::sensitivity()
## ✖ yardstick::specificity() masks caret::specificity()
## ✖ recipes::step()          masks stats::step()
## • Use tidymodels_prefer() to resolve common conflicts.</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer()</a></code> resolves the naming conflicts between it and <code>caret</code> functions. For example, invoking <code>sensitivity</code> will now point towards the tidymodels version (but the other function can be used via <code><a href="https://rdrr.io/pkg/caret/man/sensitivity.html">caret::sensitivity()</a></code>).</p>
<p>If you are new to tidymodels, we suggest taking a look at <a href="https://www.tidymodels.org/"><code>tidymodels.org</code></a> or the book <a href="https://www.tmwr.org/"><em>Tidy Modeling with R</em></a>.</p>
<p>We’ll split the data into training and test data sets, then use the <code>vfold_cv()</code> function to create cross-validation folds. There are stored in a tibble object( basically a data frame):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span>
<span class="va">tm_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">split</span><span class="op">)</span>
<span class="va">tm_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">split</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="va">cv_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">tm_train</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span>
<span class="va">cv_folds</span></code></pre></div>
<pre><code>## #  10-fold cross-validation using stratification 
## # A tibble: 10 x 2
##    splits             id    
##    &lt;list&gt;             &lt;chr&gt; 
##  1 &lt;split [1976/221]&gt; Fold01
##  2 &lt;split [1976/221]&gt; Fold02
##  3 &lt;split [1976/221]&gt; Fold03
##  4 &lt;split [1976/221]&gt; Fold04
##  5 &lt;split [1977/220]&gt; Fold05
##  6 &lt;split [1977/220]&gt; Fold06
##  7 &lt;split [1978/219]&gt; Fold07
##  8 &lt;split [1978/219]&gt; Fold08
##  9 &lt;split [1979/218]&gt; Fold09
## 10 &lt;split [1980/217]&gt; Fold10</code></pre>
<p>To use this model, we define the <em>model specification object</em> and tag which parameters that we want to tune for this model (with a value of <code>tune()</code>). the package that contains the model functions for rule-based models is called <code>rules</code>; we load that first.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/rules">rules</a></span><span class="op">)</span>

<span class="va">cubist_spec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rules.tidymodels.org/reference/cubist_rules.html">cubist_rules</a></span><span class="op">(</span>committees <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, neighbors <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"Cubist"</span><span class="op">)</span>
<span class="va">cubist_spec</span></code></pre></div>
<pre><code>## Cubist Model Specification (regression)
## 
## Main Arguments:
##   committees = tune()
##   neighbors = tune()
## 
## Computational engine: Cubist</code></pre>
<p>Now we can use the <code>tune_grid()</code> function to estimate performance for all of the parameters in the <code>grid</code> data frame:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tm_grid</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">tune_grid</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, resamples <span class="op">=</span> <span class="va">cv_folds</span>, grid <span class="op">=</span> <span class="va">grid</span><span class="op">)</span>
<span class="va">tm_grid</span></code></pre></div>
<pre><code>## # Tuning results
## # 10-fold cross-validation using stratification 
## # A tibble: 10 x 4
##    splits             id     .metrics          .notes          
##    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
##  1 &lt;split [1976/221]&gt; Fold01 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  2 &lt;split [1976/221]&gt; Fold02 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  3 &lt;split [1976/221]&gt; Fold03 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  4 &lt;split [1976/221]&gt; Fold04 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  5 &lt;split [1977/220]&gt; Fold05 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  6 &lt;split [1977/220]&gt; Fold06 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  7 &lt;split [1978/219]&gt; Fold07 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  8 &lt;split [1978/219]&gt; Fold08 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
##  9 &lt;split [1979/218]&gt; Fold09 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;
## 10 &lt;split [1980/217]&gt; Fold10 &lt;tibble [32 × 6]&gt; &lt;tibble [0 × 1]&gt;</code></pre>
<p>The results can be sown as a table or a plot:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">tm_grid</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 32 x 8
##    committees neighbors .metric .estimator    mean     n  std_err .config       
##         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;         
##  1          1         0 rmse    standard   0.00700    10 0.000425 Preprocessor1…
##  2          1         0 rsq     standard   0.778      10 0.0224   Preprocessor1…
##  3          1         1 rmse    standard   0.00776    10 0.000404 Preprocessor1…
##  4          1         1 rsq     standard   0.744      10 0.0202   Preprocessor1…
##  5          1         5 rmse    standard   0.00668    10 0.000403 Preprocessor1…
##  6          1         5 rsq     standard   0.799      10 0.0210   Preprocessor1…
##  7          1         9 rmse    standard   0.00666    10 0.000410 Preprocessor1…
##  8          1         9 rsq     standard   0.800      10 0.0213   Preprocessor1…
##  9         10         0 rmse    standard   0.00625    10 0.000371 Preprocessor1…
## 10         10         0 rsq     standard   0.823      10 0.0198   Preprocessor1…
## # … with 22 more rows</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">autoplot</span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></code></pre></div>
<p><img src="tuning_files/figure-html/tm-autoplot-1.png" width="700"></p>
<p>We can select a parameter combination as the final configuration and update our model specification object with those values.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cubist_fit</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">finalize_model</span><span class="op">(</span><span class="fu">select_best</span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">fit</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tm_train</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">cubist_fit</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tm_test</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   .pred
##   &lt;dbl&gt;
## 1 0.723
## 2 0.725
## 3 0.720
## 4 0.759
## 5 0.744
## 6 0.729</code></pre>
<p>This can be more easily done with <code>last_fit()</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cubist_results</span> <span class="op">&lt;-</span> 
  <span class="va">cubist_spec</span> <span class="op">%&gt;%</span> 
  <span class="fu">finalize_model</span><span class="op">(</span><span class="fu">select_best</span><span class="op">(</span><span class="va">tm_grid</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">last_fit</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, split <span class="op">=</span> <span class="va">split</span><span class="op">)</span>

<span class="va">cubist_results</span></code></pre></div>
<pre><code>## # Resampling results
## # Manual resampling 
## # A tibble: 1 x 6
##   splits        id           .metrics      .notes      .predictions    .workflow
##   &lt;list&gt;        &lt;chr&gt;        &lt;list&gt;        &lt;list&gt;      &lt;list&gt;          &lt;list&gt;   
## 1 &lt;split [2197… train/test … &lt;tibble [2 ×… &lt;tibble [0… &lt;tibble [733 ×… &lt;workflo…</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test set results:</span>
<span class="fu">collect_metrics</span><span class="op">(</span><span class="va">cubist_results</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard     0.00576 Preprocessor1_Model1
## 2 rsq     standard     0.857   Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test set predictions:</span>
<span class="fu">collect_predictions</span><span class="op">(</span><span class="va">cubist_results</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 733 x 5
##    id               .pred  .row Sale_Price .config             
##    &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;               
##  1 train/test split 0.723     5      0.723 Preprocessor1_Model1
##  2 train/test split 0.725    10      0.722 Preprocessor1_Model1
##  3 train/test split 0.720    11      0.720 Preprocessor1_Model1
##  4 train/test split 0.760    16      0.758 Preprocessor1_Model1
##  5 train/test split 0.744    18      0.748 Preprocessor1_Model1
##  6 train/test split 0.730    20      0.726 Preprocessor1_Model1
##  7 train/test split 0.726    23      0.727 Preprocessor1_Model1
##  8 train/test split 0.708    27      0.708 Preprocessor1_Model1
##  9 train/test split 0.712    34      0.714 Preprocessor1_Model1
## 10 train/test split 0.744    37      0.746 Preprocessor1_Model1
## # … with 723 more rows</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Max Kuhn, Ross Quinlan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
